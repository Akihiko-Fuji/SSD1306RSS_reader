# SSD1309/SSD1306 日本語RSSリーダー

Raspberry PiとSSD1309/SSD1306 OLEDディスプレイ用の、日本語表示対応RSSニュースリーダーです。ボタン操作による記事・フィード切り替えや自動スクロール表示にも対応します。

---

## 📌 主な機能

- 複数のRSSフィードを自動取得・定期更新
- 日本語ニュースのタイトル＆本文表示（日本語フォント利用可能）
- 記事本文の自動横スクロール表示
- GPIOボタンによる「記事送り」「RSSフィード切替」
- シンプルで見やすいOLED画面デザイン
- 切り替わりがわかりやすいローディング処理付き
- 開始時間、終了時間を設定するタイマー機能付き

---

## 🖼 スクリーンショット
![demo](https://github.com/Akihiko-Fuji/SSD1306RRS_reader/blob/main/demo.gif?raw=true)

---
## 💻 動作環境

- **Raspberry Pi** (Zero, 3, 4など)
- **SSD1309またはSSD1306 OLED** (I2C接続 または SPI接続, 推奨解像度: 128x64)
- **Python 3以降**
- **12ptサイズの日本語ビットマップフォント**
- 必要ライブラリ:
    - `luma.oled`
    - `feedparser`
    - `pillow`
    - `RPi.GPIO`
    - `asyncio`
    - `aiohttp`

---

## ⚡ インストール

1. 必要なライブラリのインストール
    ```sh
    pip3 install luma.oled feedparser pillow aiohttp RPi.GPIO
    ```

2. プログラムのダウンロード
    ```sh
    git clone https://github.com/Akihiko-Fuji/SSD1306RRS_reader.git
    cd SSD1306RRS_reader
    ```

3. 日本語フォントファイル（例: <a href="https://fontmeme.com/jfont/jf-dot-font/">JF-Dot-MPlusH12.ttf</a>など）をプログラムと同じディレクトリにコピー  
   ※他のフォントも指定可能です。利用する液晶の特性上、アンチエイリアス処理がおこなえないためビットマップフォントの利用を推奨します。 

4. 必要に応じ、ソースコード内のI2Cアドレス・ピン番号・解像度などを自分の環境に合わせて編集

---

## 🚀 使い方

```sh
python3 SSD1309-RSS.py
```

- 起動後、OLEDに日本語ニュースがスクロール表示されます
- 一定時間でフィード切り替えとなりますが、物理ボタン(GPIO 18)のシングルクリックで「記事送り」、ダブルクリックで「フィード切替」が可能です
- GPIOモジュールが読み込めない環境では自動的にソフトウェアモードで起動し、ボタン無しでも自動巡回が継続します
---

## 🔌 配線例(I2C接続の場合)
|Raspberry Pi	|OLED	|備考|
|---|---|---|
|3.3V |VCC	|SSD1306/1309共に5Vでも動作しますが、プルアップ抵抗を利用する場合は3.3V接続をおこなってください  |
|GND	|GND	|  |
|SDA (GPIO 2)	|SDA	|I2C通信,配線を伸ばす場合は、VCCに2.2kΩのプルアップ抵抗を介して接続してください|
|SCL (GPIO 3)	|SCL	|I2C通信,配線を伸ばす場合は、VCCに2.2kΩのプルアップ抵抗を介して接続してください|
- ボタン用GPIOピン例: GPIO18（次記事、フィード切替）
- 点灯ラインが多い場合に発生する、描画時ノイズはVCC GND間に180uF程度のキャパシタを追加すると抑制できるようです

---

## 📝 フィード・フォントのカスタマイズ
- RSSフィードは同梱の `rss-read.me` で編集・追加できます（`title,url,color,type` のCSV形式）
- `type` に `text` を指定すると、RSS以外の汎用テキスト（ローカルファイル/URL）も表示できます
- 日本語フォントを差し替える場合は_init_fonts関数内のパスを書き換えてください
- スクロール速度・記事表示時間も調整可能です

---

## ⚙️ 主な設定値
- `USE_SPI`: `True`でSPI接続、`False`でI2C接続を利用します（デフォルトはI2C）。
- `DISPLAY_TIME_START` / `DISPLAY_TIME_END`: 表示を有効にする時刻帯。デフォルトでは8:30〜18:00のみ点灯します。
- `RSS_UPDATE_INTERVAL`: RSSフィードの再取得間隔（秒）。初期値は30分ごとです。
- `FEED_SWITCH_INTERVAL`: 自動フィード切り替え間隔（秒）。初期値は10分。
- `ARTICLE_DISPLAY_TIME`: スクロール不要な短文記事を切り替えるまでの待機時間（秒）。
- `DOUBLE_CLICK_INTERVAL`: ダブルクリック判定の間隔（秒）。GPIO 18のボタンを短時間で2回押すとフィード切り替えになります。
- その他の描画・スクロール関連パラメータも `RSSReaderApp` クラス内にまとまっているので、必要に応じて調整してください。

---

## 🛰 ネットワーク動作のポイント
- RSS取得は`aiohttp`による非同期通信で複数フィードを並列に取得します。
- 取得に失敗した場合でもキャッシュ済みのデータを自動的にフォールバックして表示し続けます。
- ローディング演出やログ出力で取得状況を確認できるため、ネットワークトラブル時の調査が容易です。

---

## ⚠️ 既知の課題
- 一部のRSSで文字化けや説明テキストが正しく取得できないことがあります
- OLED表示やボタンの配線ミスにご注意ください

---

## 🔍 バージョンアップ履歴
ver1.8.1
- 長時間稼働させた際に発生する、list index out of rangeを抑制しました

ver1.8
- リファクタリングをおこないました。気を使った感じのコードに仕上げました

ver1.7
- RSS対象をコード外ファイル(rss-read.me)に移し、追加削除を容易にしました

ver1.6
- 非同期読み出しに対応し、RSS読み取りしている間にLCD画面が停止しなくなりました

ver1.5
- リファクタリングをおこないました。機能上の変更はありません

ver1.4
- GPIOボタンが適切に動作していなかった問題を修正しました。GPIO 18ボタンのみ利用する形とし、シングルクリックで記事送り、ダブルクリックでフィード送りという操作インターフェースに変更しました
- 操作の都合上、記事戻し機能は無くなりました（機能は残していますので必要に応じてGPIOに割り当てるなどしてください）

ver1.3
- NHK ONEに対応しました。また、GPIOボタンだけでなく自動でRSSフィードが切り替わるようにしました
- 記事が最後まで読めるように切り替えタイミングを修正しました

ver1.2
- SPI接続に対応しました。設定ファイルはありませんので、コード内でどちらの接続をおこなうか切り替えてください

ver1.1
- 画面表示の開始終了タイマー機能追加、タイトルと時計の位置調整、アニメーション処理の変更
- タイトル本文の区切位置の調整、ターミナルへの出力メッセージを英語に変更（文字化け対策）


ver1.0
- リリース。SSD1306を使ってみたくて制作

---

## 👤 作者
- Akihiko Fuji
- ご質問・不具合は [issues](https://github.com/Akihiko-Fuji/SSD1306RRS_reader/issues) まで
